{% extends 'base.html' %}

{% block title %}Dashboard - S3Guard{% endblock %}

{% block content %}
    <div class="bg-white p-8 rounded-lg shadow-xl border border-gray-200">
        <h2 class="text-4xl font-extrabold text-gray-900 mb-8 text-center">Hello, {{ username }}!</h2>

        {# Public Buckets Alert Card #}
        {% if public_buckets %}
            <div class="bg-red-50 border border-red-400 text-red-800 p-6 rounded-lg shadow-md mb-8">
                <h3 class="text-2xl font-bold mb-4 flex items-center">
                    <svg class="w-7 h-7 mr-3 text-red-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2.001 4.041-2.001 5.196 0L19.72 10.703a4.5 4.5 0 010 4.594L14.597 21.003c-1.155 2.001-4.041 2.001-5.196 0L4.28 15.297a4.5 4.5 0 010-4.594L9.401 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd"></path></svg>
                    Critical Security Alert!
                </h3>
                <p class="text-lg mb-4">The following S3 buckets are publicly accessible. This poses a significant security risk. Please review them immediately:</p>
                <ul class="list-disc pl-5 space-y-2 mb-6">
                    {% for bucket_info in public_buckets %}
                        <li>
                            <span class="font-semibold">{{ bucket_info.name }}</span> (Reason: {{ bucket_info.reason }})
                            <a href="https://s3.console.aws.amazon.com/s3/buckets/{{ bucket_info.name }}?tab=permissions" target="_blank" class="text-blue-700 hover:text-blue-900 underline ml-2 text-sm">
                                View in AWS Console <span aria-hidden="true">â†—</span>
                            </a>
                        </li>
                    {% endfor %}
                </ul>
                <p class="text-sm">Public buckets can lead to data breaches. Always ensure your S3 permissions follow the principle of least privilege.</p>
            </div>
        {% endif %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
            {# Overall Statistics Card #}
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 shadow-md">
                <h3 class="text-xl font-bold text-blue-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                    Overall Statistics
                </h3>
                <p class="text-gray-700 text-lg mb-2">Total Registered Users: <span class="font-bold text-blue-700">{{ total_users }}</span></p>
                <p class="text-gray-600 text-sm">Growing our community of cloud managers!</p>
            </div>

            {# AWS Credentials Management Card #}
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-md">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2V9a2 2 0 012-2h2zm0 7v3m-4-3v3m-4-3v3M6 18h2a2 2 0 002-2v-4a2 2 0 00-2-2H6a2 2 0 00-2 2v4a2 2 0 002 2z"></path></svg>
                    Your AWS Credentials
                </h3>
                <p class="text-gray-600 mb-5">Securely store your AWS Access Keys to manage your S3 resources.</p>
                <form action="{{ url_for('credentials') }}" method="POST" class="space-y-4">
                    <div>
                        <label for="access_key" class="block text-gray-700 text-sm font-medium mb-2">AWS Access Key ID</label>
                        <input 
                            type="text" 
                            id="access_key" 
                            name="access_key" 
                            class="appearance-none border border-gray-300 rounded-lg w-full py-2.5 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 shadow-sm" 
                            placeholder="Enter your AWS Access Key ID"
                            required
                        >
                    </div>
                    <div>
                        <label for="secret_key" class="block text-gray-700 text-sm font-medium mb-2">AWS Secret Access Key</label>
                        <input 
                            type="password" 
                            id="secret_key" 
                            name="secret_key" 
                            class="appearance-none border border-gray-300 rounded-lg w-full py-2.5 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 shadow-sm" 
                            placeholder="Enter your AWS Secret Access Key"
                            required
                        >
                    </div>
                    <button 
                        type="submit" 
                        class="bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-2.5 px-5 rounded-lg focus:outline-none focus:ring-4 focus:ring-indigo-300 transition duration-300 ease-in-out transform hover:-translate-y-0.5 shadow-md w-full"
                    >
                        Save Credentials
                    </button>
                </form>
            </div>
        </div>

        {# Quick Actions Card #}
        <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-md">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                Quick Actions
            </h3>
            <p class="text-gray-600 mb-5">Jump directly to your S3 resources or review past activities.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <a href="{{ url_for('buckets') }}" 
                   class="bg-emerald-500 hover:bg-emerald-600 active:bg-emerald-700 text-white text-center font-semibold py-3 px-6 rounded-lg focus:outline-none focus:ring-4 focus:ring-emerald-300 transition duration-300 ease-in-out transform hover:-translate-y-0.5 shadow-md flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h12a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm0 5a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path></svg>
                    View S3 Buckets
                </a>
                <a href="{{ url_for('view_logs') }}" 
                   class="bg-teal-500 hover:bg-teal-600 active:bg-teal-700 text-white text-center font-semibold py-3 px-6 rounded-lg focus:outline-none focus:ring-4 focus:ring-teal-300 transition duration-300 ease-in-out transform hover:-translate-y-0.5 shadow-md flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 2a8 8 0 100 16 8 8 0 000-16zM6 9a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path></svg>
                    View Action Logs
                </a>
            </div>
        </div>
    </div>
{% endblock %}

