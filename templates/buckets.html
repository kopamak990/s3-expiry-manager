{% extends 'base.html' %}

{% block title %}S3 Buckets - S3Flow{% endblock %}

{% block head %}
<script>
    // Client-side search functionality for objects table
    function filterObjects() {
        const searchInput = document.getElementById('objectSearch');
        const filter = searchInput.value.toLowerCase();
        const tableBody = document.getElementById('objectTableBody');
        const rows = tableBody.getElementsByTagName('tr');

        for (let i = 0; i < rows.length; i++) {
            const keyCell = rows[i].getElementsByTagName('td')[0]; // First column is Key
            if (keyCell) {
                const textValue = keyCell.textContent || keyCell.innerText;
                if (textValue.toLowerCase().indexOf(filter) > -1) {
                    rows[i].style.display = "";
                } else {
                    rows[i].style.display = "none";
                }
            }
        }
    }
</script>
{% endblock %}

{% block content %}
    <div class="bg-white p-8 rounded-lg shadow-xl border border-gray-200">
        <h2 class="text-3xl font-extrabold text-gray-900 mb-6">Your S3 Buckets</h2>

        <a href="{{ url_for('dashboard') }}" class="inline-flex items-center bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg text-sm mb-6 transition duration-200 transform hover:-translate-y-0.5 shadow-sm">
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path></svg>
            Back to Dashboard
        </a>

        {% if buckets %}
            <ul class="space-y-4">
                {% for bucket in buckets %}
                    <li class="bg-gray-50 p-5 rounded-lg shadow-sm flex flex-col md:flex-row items-start md:items-center justify-between border border-gray-100 transition duration-200 hover:shadow-md hover:border-blue-300">
                        <div class="mb-2 md:mb-0">
                            <span class="text-xl font-semibold text-gray-800">{{ bucket.Name }}</span>
                            <p class="text-sm text-gray-500">
                                Created: {{ bucket.CreationDate.strftime('%Y-%m-%d %H:%M:%S UTC') if bucket.CreationDate else 'N/A' }}
                            </p>
                        </div>
                        <a href="{{ url_for('bucket_objects', bucket_name=bucket.Name) }}" 
                           class="bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-semibold py-2 px-4 rounded-lg text-sm shadow-md transition duration-300 ease-in-out transform hover:-translate-y-0.5">
                           View Objects
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="p-6 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800 text-center">
                <p class="text-lg font-semibold mb-2">No S3 buckets found!</p>
                <p>Please ensure your AWS credentials are correctly set on the <a href="{{ url_for('dashboard') }}" class="font-bold underline hover:text-yellow-900">Dashboard</a> and have the necessary S3 permissions.</p>
            </div>
        {% endif %}
    </div>
{% endblock %}
